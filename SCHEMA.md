# JSON Schema for League Data

This document describes the structure of the `leagueData.json` file generated by the Python script and consumed by the React website.

## Root Object

```typescript
{
  lastUpdated: string,           // ISO 8601 timestamp
  leagues: {
    [leagueName: string]: League
  },
  globalLeaderboard: Player[]
}
```

## Types

### League

```typescript
{
  subLeagues: {
    [subLeagueName: string]: SubLeague
  }
}
```

### SubLeague

```typescript
{
  rounds: Round[],
  leaderboard: Player[]
}
```

### Round

```typescript
{
  round: string,                  // e.g., "R1", "R2"
  status: "open" | "in_progress" | "finished",
  matchId: string,                // Chess.com match ID
  matchUrl: string,               // Full URL to match
  name: string,                   // Match name/title
  startTime?: number,             // Unix timestamp (seconds)
  endTime?: number,               // Unix timestamp (seconds)
  playerStats: {
    [username: string]: {
      games: number,
      wins: number,
      draws: number,
      losses: number
    }
  }
}
```

### Player

```typescript
{
  username: string,               // Chess.com username
  games: number,                  // Total games played
  wins: number,                   // Total wins
  draws: number,                  // Total draws
  losses: number,                 // Total losses
  points: number                  // Total points (1 per win, 0.5 per draw)
}
```

## Example

```json
{
  "lastUpdated": "2026-02-17T02:00:00Z",
  "leagues": {
    "1WL": {
      "subLeagues": {
        "summer league": {
          "rounds": [
            {
              "round": "R1",
              "status": "finished",
              "matchId": "12345",
              "matchUrl": "https://www.chess.com/club/matches/12345",
              "name": "1WL summer league R1",
              "startTime": 1708128000,
              "endTime": 1708214400,
              "playerStats": {
                "player1": {
                  "games": 3,
                  "wins": 2,
                  "draws": 1,
                  "losses": 0
                },
                "player2": {
                  "games": 3,
                  "wins": 1,
                  "draws": 0,
                  "losses": 2
                }
              }
            }
          ],
          "leaderboard": [
            {
              "username": "player1",
              "games": 12,
              "wins": 8,
              "draws": 2,
              "losses": 2,
              "points": 9.0
            },
            {
              "username": "player2",
              "games": 10,
              "wins": 5,
              "draws": 3,
              "losses": 2,
              "points": 6.5
            }
          ]
        }
      }
    }
  },
  "globalLeaderboard": [
    {
      "username": "player1",
      "games": 45,
      "wins": 30,
      "draws": 8,
      "losses": 7,
      "points": 34.0
    },
    {
      "username": "player2",
      "games": 38,
      "wins": 22,
      "draws": 10,
      "losses": 6,
      "points": 27.0
    }
  ]
}
```

## Field Descriptions

### Status Values

- **open**: Match registration is open, not yet started
- **in_progress**: Match has started but not completed
- **finished**: Match has ended

### Timestamps

- All timestamps are Unix timestamps in seconds (not milliseconds)
- Use JavaScript `new Date(timestamp * 1000)` to convert
- `startTime` and `endTime` may be null for open matches

### Points Calculation

- Win: 1 point
- Draw: 0.5 points
- Loss: 0 points

### Leaderboard Sorting

Players are sorted by:
1. Points (descending)
2. Games played (ascending) - as a tiebreaker

### Username
# JSON Schema for League Data

This document describes the actual structure of `leagueData.json` produced by `scripts/fetch_league_data.py` and consumed by the React UI. It includes fields for match metadata, results (including forfeit detection), registration information, and board-level rating data.

## Root Object

```typescript
{
  lastUpdated: string,           // ISO 8601 timestamp (UTC)
  leagues: {
    [leagueName: string]: League
  },
  globalLeaderboard: Player[]
}
```

## Types

### League

```typescript
{
  subLeagues: {
    [subLeagueName: string]: SubLeague
  }
}
```

### SubLeague

```typescript
{
  rounds: Round[],
  leaderboard: Player[],
  record?: { wins: number, losses: number, draws: number }
}
```

### Round

```typescript
{
  round?: string | null,             // e.g. "R1" or auto-assigned "R3"; may be null initially
  status: "open" | "in_progress" | "finished",
  matchId: string,                   // API identifier (often full API URL)
  matchUrl: string,                  // API URL
  matchWebUrl?: string,              // Web-friendly URL (https://www.chess.com/club/matches/{id})
  name: string,                      // Original match title
  startTime?: number | null,         // Unix seconds (may be null)
  endTime?: number | null,           // Unix seconds (may be null)
  boards: number,                    // Number of boards in the match
  matchResult: {
    ourScore: number,
    opponentScore: number,
    result: "win" | "lose" | "draw" | "forfeit" | "double forfeit" | "win by forfeit" | "unknown"
  },
  playerStats: {
    [username: string]: {
      games: number,
      wins: number,
      draws: number,
      losses: number
    }
  },

  // Registration-related fields (present for registration/open matches)
  registrationData?: {
    // If boards are not yet assigned this will be a roster object
    type: "roster",
    ourRoster: { username: string, rating?: number }[],
    oppRoster: { username: string, rating?: number }[]
  } | null,

  // If boards are assigned, boardsData is an array of per-board objects
  boardsData?: {
    boardNumber: number,
    ourPlayer?: string,
    ourRating?: number | null,
    oppPlayer?: string,
    oppRating?: number | null,
    ratingDiff?: number | null
  }[],

  registeredPlayers?: { our: number, opponent: number },
  minTeamPlayers?: number  // Present for all matches, extracted from match settings
}
```

### Player

```typescript
{
  username: string,
  games: number,
  wins: number,
  draws: number,
  losses: number,
  points?: number
}
```

## Additional Notes

- `matchId` and `matchUrl` are often full API URLs (e.g. `https://api.chess.com/pub/match/1895389`). `matchWebUrl` is provided for convenient linking to the chess.com UI.
- `round` may be parsed from the match title (e.g. `R1`) or auto-assigned by the script when the title looks like a team matchup (e.g. `Team A vs Team B`). Auto-numbered rounds are set to `R{n}`.
- `registrationData` is present for `open` matches; if boards are not assigned it provides sorted rosters for strategic planning. If boards are assigned `boardsData` will be an array with ratings per board.
- `registeredPlayers` provides simple counts used by the UI to show registration progress.
- `minTeamPlayers` is extracted from match settings and available for all matches (not just registration). Used for forfeit detection.
- `playerStats` contains only stats aggregated from matches where our club's players participated (the script filters to our club when building per-player stats).

### Forfeit Detection

For **finished** matches with a 0-0 score, the script automatically detects forfeits based on player counts vs. `minTeamPlayers`:
- **"forfeit"**: We failed to meet minimum players (we lose)
- **"double forfeit"**: Both teams failed to meet minimum (we lose)
- **"win by forfeit"**: Opponent failed to meet minimum (we win)

This only applies to completed matches and does not affect registration warnings for open matches.

## Examples

Partial example of a finished round:

```json
{
  "round": "R3",
  "status": "finished",
  "matchId": "https://api.chess.com/pub/match/1895389",
  "matchUrl": "https://api.chess.com/pub/match/1895389",
  "matchWebUrl": "https://www.chess.com/club/matches/1895389",
  "name": "1WL summer league R3: 1 day per move club vs I like beer",
  "startTime": 1769328243,
  "endTime": 1771258083,
  "boards": 4,
  "matchResult": { "ourScore": 5, "opponentScore": 3, "result": "win" },
  "playerStats": {
    "engelleik": { "games": 2, "wins": 2, "draws": 0, "losses": 0 }
  }
}
```

Partial example of an open registration match with roster data:

```json
{
  "round": null,
  "status": "open",
  "matchId": "https://api.chess.com/pub/match/1895427",
  "matchUrl": "https://api.chess.com/pub/match/1895427",
  "name": "1WL ...: 1 day per move club vs Africa Chess Group",
  "startTime": 1769328244,
  "boards": 7,
  "registrationData": {
    "type": "roster",
    "ourRoster": [ { "username": "legit_chess411", "rating": 1500 } ],
    "oppRoster": [ { "username": "opponent1", "rating": 1480 } ]
  },
  "registeredPlayers": { "our": 6, "opponent": 7 },
  "minTeamPlayers": 8
}
```

Partial example of an open registration match with board assignments:

```json
{
  "status": "open",
  "boards": 6,
  "boardsData": [
    { "boardNumber": 1, "ourPlayer": "alice", "ourRating": 1600, "oppPlayer": "bob", "oppRating": 1550, "ratingDiff": 50 }
  ],
  "registeredPlayers": { "our": 6, "opponent": 6 }
}
```

## Sorting & Calculations

- Leaderboards are computed by summing `wins` + 0.5 * `draws` into `points` and sorted by points (desc) then games (asc).
- Sub-league `record` is derived from `matchResult.result` values across rounds.

## Migration / Compatibility

If you adapt the script for another club or change `LEAGUE_PREFIXES`, ensure your match titles place the league prefix first and follow a consistent pattern so the `parse_match_title` logic can extract `league`, `subLeague`, and `round` as intended.
